<!DOCTYPE html>
<html lang="pt">
<head>
    <title>Como o compilador do Rust funciona? | scovl</title>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Uma vis√£o geral do compilador do Rust">



<link rel="preload" href="/vendor/fonts/inter/Inter-400.ttf" as="font" type="font/ttf" crossorigin>
<link rel="preload" href="/vendor/fonts/inter/Inter-600.ttf" as="font" type="font/ttf" crossorigin>
<link rel="preload" href="/vendor/fonts/jetbrains-mono/JetBrainsMono-400.ttf" as="font" type="font/ttf" crossorigin>



<link rel="dns-prefetch" href="//giscus.app">
<link rel="preconnect" href="//giscus.app">



<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no"> 


<link rel="stylesheet" href="/css/main.css?v=1757087164">


<link rel="stylesheet" href="/vendor/fonts/fonts.css?v=1757087164">


<link rel="preload" href="/fonts/abril-fatface.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/rokkitt.woff2" as="font" type="font/woff2" crossorigin>


<link rel="stylesheet" href="/vendor/prism/prism-tomorrow.min.css?v=1757087164">



<script src="/vendor/mermaid/mermaid.min.js?v=1757087164"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        mermaid.initialize({
            startOnLoad: true,
            theme: 'light',
            align: 'center'
        });SS
    });
</script>












<script>

const I18n = {
    currentLang: 'pt',
    isRTL:  false ,
    
    
    formatDate(date, options = {}) {
        const defaultOptions = {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        };
        
        const locale = this.getLocale();
        const finalOptions = { ...defaultOptions, ...options };
        
        return new Intl.DateTimeFormat(locale, finalOptions).format(date);
    },
    
    
    formatNumber(number, options = {}) {
        const defaultOptions = {
            style: 'decimal',
            minimumFractionDigits: 0,
            maximumFractionDigits: 2
        };
        
        const locale = this.getLocale();
        const finalOptions = { ...defaultOptions, ...options };
        
        return new Intl.NumberFormat(locale, finalOptions).format(number);
    },
    
    
    formatCurrency(amount, currency = 'USD') {
        const locale = this.getLocale();
        return new Intl.NumberFormat(locale, {
            style: 'currency',
            currency: currency
        }).format(amount);
    },
    
    
    formatRelativeTime(date) {
        const locale = this.getLocale();
        const now = new Date();
        const diff = now - date;
        const diffInMinutes = Math.floor(diff / (1000 * 60));
        const diffInHours = Math.floor(diff / (1000 * 60 * 60));
        const diffInDays = Math.floor(diff / (1000 * 60 * 60 * 24));
        
        if (diffInMinutes < 1) {
            return new Intl.RelativeTimeFormat(locale).format(0, 'minute');
        } else if (diffInMinutes < 60) {
            return new Intl.RelativeTimeFormat(locale).format(-diffInMinutes, 'minute');
        } else if (diffInHours < 24) {
            return new Intl.RelativeTimeFormat(locale).format(-diffInHours, 'hour');
        } else {
            return new Intl.RelativeTimeFormat(locale).format(-diffInDays, 'day');
        }
    },
    
    
    getLocale() {
        const localeMap = {
            'en': 'en-US',
            'pt': 'pt-BR',
            'es': 'es-ES',
            'fr': 'fr-FR',
            'de': 'de-DE',
            'it': 'it-IT',
            'ar': 'ar-SA',
            'he': 'he-IL',
            'fa': 'fa-IR',
            'ur': 'ur-PK',
            'zh': 'zh-CN',
            'ja': 'ja-JP',
            'ko': 'ko-KR'
        };
        
        return localeMap[this.currentLang] || 'en-US';
    },
    
    
    t(key, params = {}) {
        const translations = {
            'en': {
                'read_more': 'Read more',
                'back_to_top': 'Back to top',
                'loading': 'Loading...',
                'error': 'Error',
                'success': 'Success',
                'warning': 'Warning',
                'info': 'Information',
                'comments': 'Comments',
                'related_posts': 'Related Posts',
                'tags': 'Tags',
                'categories': 'Categories',
                'search': 'Search',
                'menu': 'Menu',
                'close': 'Close',
                'language': 'Language',
                'theme': 'Theme',
                'dark_mode': 'Dark Mode',
                'light_mode': 'Light Mode'
            },
            'pt': {
                'read_more': 'Ler mais',
                'back_to_top': 'Voltar ao topo',
                'loading': 'Carregando...',
                'error': 'Erro',
                'success': 'Sucesso',
                'warning': 'Aviso',
                'info': 'Informa√ß√£o',
                'comments': 'Coment√°rios',
                'related_posts': 'Posts Relacionados',
                'tags': 'Tags',
                'categories': 'Categorias',
                'search': 'Pesquisar',
                'menu': 'Menu',
                'close': 'Fechar',
                'language': 'Idioma',
                'theme': 'Tema',
                'dark_mode': 'Modo Escuro',
                'light_mode': 'Modo Claro'
            },
            'es': {
                'read_more': 'Leer m√°s',
                'back_to_top': 'Volver arriba',
                'loading': 'Cargando...',
                'error': 'Error',
                'success': '√âxito',
                'warning': 'Advertencia',
                'info': 'Informaci√≥n',
                'comments': 'Comentarios',
                'related_posts': 'Posts Relacionados',
                'tags': 'Etiquetas',
                'categories': 'Categor√≠as',
                'search': 'Buscar',
                'menu': 'Men√∫',
                'close': 'Cerrar',
                'language': 'Idioma',
                'theme': 'Tema',
                'dark_mode': 'Modo Oscuro',
                'light_mode': 'Modo Claro'
            },
            'ar': {
                'read_more': 'ÿßŸÇÿ±ÿ£ ÿßŸÑŸÖÿ≤ŸäÿØ',
                'back_to_top': 'ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑÿ£ÿπŸÑŸâ',
                'loading': 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...',
                'error': 'ÿÆÿ∑ÿ£',
                'success': 'ŸÜÿ¨ÿ≠',
                'warning': 'ÿ™ÿ≠ÿ∞Ÿäÿ±',
                'info': 'ŸÖÿπŸÑŸàŸÖÿßÿ™',
                'comments': 'ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™',
                'related_posts': 'ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™ ÿ∞ÿßÿ™ ÿßŸÑÿµŸÑÿ©',
                'tags': 'ÿßŸÑÿπŸÑÿßŸÖÿßÿ™',
                'categories': 'ÿßŸÑŸÅÿ¶ÿßÿ™',
                'search': 'ÿ®ÿ≠ÿ´',
                'menu': 'ÿßŸÑŸÇÿßÿ¶ŸÖÿ©',
                'close': 'ÿ•ÿ∫ŸÑÿßŸÇ',
                'language': 'ÿßŸÑŸÑÿ∫ÿ©',
                'theme': 'ÿßŸÑŸÖÿ∏Ÿáÿ±',
                'dark_mode': 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÖÿ∏ŸÑŸÖ',
                'light_mode': 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠'
            }
        };
        
        const langTranslations = translations[this.currentLang] || translations['en'];
        let text = langTranslations[key] || key;
        
        
        Object.keys(params).forEach(param => {
            text = text.replace(`{${param}}`, params[param]);
        });
        
        return text;
    },
    
    
    init() {
        this.updatePageDirection();
        this.updateDateFormats();
        this.updateNumberFormats();
        this.updateTranslations();
    },
    
    
    updatePageDirection() {
        if (this.isRTL) {
            document.documentElement.setAttribute('dir', 'rtl');
            document.documentElement.setAttribute('lang', this.currentLang);
        }
    },
    
    
    updateDateFormats() {
        const dateElements = document.querySelectorAll('[data-date]');
        dateElements.forEach(element => {
            const date = new Date(element.getAttribute('data-date'));
            const format = element.getAttribute('data-date-format') || 'default';
            
            let formattedDate;
            switch (format) {
                case 'relative':
                    formattedDate = this.formatRelativeTime(date);
                    break;
                case 'short':
                    formattedDate = this.formatDate(date, { month: 'short', day: 'numeric' });
                    break;
                case 'long':
                    formattedDate = this.formatDate(date, { 
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    break;
                default:
                    formattedDate = this.formatDate(date);
            }
            
            element.textContent = formattedDate;
        });
    },
    
    
    updateNumberFormats() {
        const numberElements = document.querySelectorAll('[data-number]');
        numberElements.forEach(element => {
            const number = parseFloat(element.getAttribute('data-number'));
            const format = element.getAttribute('data-number-format') || 'decimal';
            
            let formattedNumber;
            switch (format) {
                case 'currency':
                    const currency = element.getAttribute('data-currency') || 'USD';
                    formattedNumber = this.formatCurrency(number, currency);
                    break;
                case 'percent':
                    formattedNumber = this.formatNumber(number / 100, { style: 'percent' });
                    break;
                default:
                    formattedNumber = this.formatNumber(number);
            }
            
            element.textContent = formattedNumber;
        });
    },
    
    
    updateTranslations() {
        const translationElements = document.querySelectorAll('[data-i18n]');
        translationElements.forEach(element => {
            const key = element.getAttribute('data-i18n');
            const params = {};
            
            
            const paramAttributes = element.getAttribute('data-i18n-params');
            if (paramAttributes) {
                try {
                    Object.assign(params, JSON.parse(paramAttributes));
                } catch (e) {
                    console.warn('Invalid i18n params:', paramAttributes);
                }
            }
            
            element.textContent = this.t(key, params);
        });
    }
};


window.I18n = I18n;
</script>


<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('\/sw.js')
                .then(function(registration) {
                    console.log('Service Worker registrado com sucesso:', registration.scope);
                })
                .catch(function(error) {
                    console.log('Falha no registro do Service Worker:', error);
                });
        });
    }
</script> 
</head>
<body>
    
    
    <header class="header">
    <div class="container">
        <div class="header-content">
            <a href="https://scovl.github.io/" class="site-title">scovl</a>
            
            <div class="header-actions">
                
                <nav class="nav-menu">
                    <ul>
                        
                        <li><a href="/page/about/">About</a></li>
                        
                        <li><a href="/page/contact/">Contact</a></li>
                        
                    </ul>
                </nav>
                
                
                



<div class="language-switcher" id="language-switcher">
    <button class="language-btn" onclick="toggleLanguageMenu()">
        <span class="current-lang">Portugu√™s</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6,9 12,15 18,9"></polyline>
        </svg>
    </button>
    <div class="language-menu" id="language-menu">
        
            
                <a href="https://scovl.github.io/" class="language-option active">
                    Portugu√™s
                </a>
            
        
            
                <a href="https://scovl.github.io/en/" class="language-option ">
                    English
                </a>
            
        
    </div>
</div>
                
                
                <button id="dark-mode-toggle" class="theme-toggle" aria-label="Toggle dark mode">
                    <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                    <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</header> 
    
    
    
    <main>
        <div class="container">
            
<article class="post">
    <header class="post-header">
        <h1 class="post-title">Como o compilador do Rust funciona?</h1>
        
        <div class="post-meta">
            <time datetime="2025-07-21T12:00:00Z">
                üìÖ 21/07/2025
            </time>
            
            <span>üë§ Vitor Lobo Ramos</span>
            
            
            
            <div class="post-tags">
                
                <a href="/tags/rust" class="tag">Rust</a>
                
                <a href="/tags/compiladores" class="tag">Compiladores</a>
                
                <a href="/tags/llvm" class="tag">LLVM</a>
                
                <a href="/tags/mem%C3%B3ria" class="tag">Mem√≥ria</a>
                
                <a href="/tags/seguran%C3%A7a" class="tag">Seguran√ßa</a>
                
            </div>
            
        </div>
        
    </header>
    
    
    















  

  

  

  

  

  



<aside class="toc" id="toc" aria-labelledby="toc-title">
    <div class="toc-container">
        <div class="toc-header">
            <h3 id="toc-title" class="toc-title">
                <svg class="toc-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 6h18M3 12h18M3 18h18"/>
                </svg>
                Sum√°rio
            </h3>
            <button class="toc-toggle" id="toc-toggle" aria-expanded="true" aria-controls="toc-content" aria-label="Mostrar/Ocultar Sum√°rio">
                <svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m6 9 6 6 6-6"/>
                </svg>
            </button>
        </div>
        <div class="toc-content" id="toc-content">
            <div class="toc-progress">
                <div class="toc-progress-bar" id="toc-progress-bar"></div>
            </div>
            <nav class="toc-nav">
                <nav id="TableOfContents">
  <ul>
    <li><a href="#introdu√ß√£o">Introdu√ß√£o</a>
      <ul>
        <li><a href="#a-ponte-entre-seu-c√≥digo-e-o-computador">A ponte entre seu c√≥digo e o computador</a></li>
        <li><a href="#o-compilador-do-rust">O compilador do Rust</a></li>
        <li><a href="#o-mago-da-mem√≥ria-entendendo-o-borrow-checker">O Mago da Mem√≥ria: Entendendo o Borrow Checker</a></li>
        <li><a href="#por-que-tanta-etapa-intermedi√°ria">Por que tanta etapa intermedi√°ria?</a></li>
        <li><a href="#refer√™ncias">REFER√äNCIAS</a></li>
      </ul>
    </li>
  </ul>
</nav>
            </nav>
        </div>
    </div>
    
    
    <button class="toc-mobile-toggle" id="toc-mobile-toggle" aria-label="Mostrar Sum√°rio">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 6h18M3 12h18M3 18h18"/>
        </svg>
    </button>
</aside>



    
    <div class="post-content">
        <h1 id="introdu√ß√£o">Introdu√ß√£o</h1>
<p>O Rust √© famoso por ser uma linguagem que evita muitos erros de mem√≥ria sem precisar de um coletor de lixo rodando em segundo plano. Mas como ele faz isso? O segredo est√° no compilador, que passa seu c√≥digo por v√°rias etapas at√© virar um programa que o computador entende.</p>
<p>Neste artigo, explicarei de forma simples cada fase desse processo: desde a leitura do c√≥digo <strong><a href="https://en.wikipedia.org/wiki/Lexical_analysis">lexing</a></strong>, passando pela an√°lise da estrutura <strong><a href="https://en.wikipedia.org/wiki/Parsing">parsing</a></strong>, at√© a gera√ß√£o do c√≥digo final pelo <strong><a href="https://llvm.org/">LLVM</a></strong>.</p>
<p>Mostrarei como o <strong><a href="https://doc.rust-lang.org/reference/borrow-checker.html">borrow checker</a></strong> (aquele que reclama dos seus empr√©stimos de vari√°veis), as representa√ß√µes intermedi√°rias (com nomes esquisitos como <a href="https://en.wikipedia.org/wiki/High-level_intermediate_representation">HIR</a>, <a href="https://en.wikipedia.org/wiki/Typed_high_level_intermediate_representation">THIR</a> e <a href="https://en.wikipedia.org/wiki/Mid-level_intermediate_representation">MIR</a>) e as otimiza√ß√µes finais trabalham juntos para impedir problemas como dois lugares mexendo na mesma mem√≥ria ao mesmo tempo <strong><a href="https://en.wikipedia.org/wiki/Race_condition">data race</a></strong> ou acessar algo que j√° foi apagado <strong><a href="https://en.wikipedia.org/wiki/Use-after-free">use-after-free</a></strong>.</p>
<p>No fim das contas, a arquitetura em camadas do compilador do Rust permite que ele seja r√°pido como C, mas com muito mais garantias de que seu programa n√£o vai dar pau por causa de bugs dif√≠ceis de achar. Tudo isso gra√ßas a essas etapas intermedi√°rias e checagens autom√°ticas que acontecem antes mesmo do programa rodar.</p>
<h2 id="a-ponte-entre-seu-c√≥digo-e-o-computador">A ponte entre seu c√≥digo e o computador</h2>
<p>Linguagens como <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>, <a href="https://en.wikipedia.org/wiki/Go_%28programming_language%29">Go</a> e <a href="https://en.wikipedia.org/wiki/Rust_%28programming_language%29">Rust</a> ficam em um ponto intermedi√°rio: elas oferecem mais controle sobre o funcionamento do computador do que linguagens como <a href="https://en.wikipedia.org/wiki/Java_%28programming_language%29">Java</a> ou <a href="https://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29">C#</a>, mas n√£o s√£o t√£o pr√≥ximas do hardware quanto <a href="https://en.wikipedia.org/wiki/Assembly_language">Assembly</a>.</p>
<p>O que as diferencia √© a forma como lidam com a mem√≥ria: em C, o programador tem liberdade total para manipular ponteiros, mas tamb√©m assume todos os riscos de erros; em Go, existe um coletor de lixo que gerencia a mem√≥ria automaticamente; j√° o Rust criou um sistema pr√≥prio de &ldquo;posse e empr√©stimo&rdquo; (ownership e borrowing), que previne muitos problemas de mem√≥ria j√° na fase de compila√ß√£o, antes mesmo do programa rodar.</p>
<blockquote>
<p>Quando falamos que linguagens como <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a>, <a href="https://en.wikipedia.org/wiki/Go_%28programming_language%29">Go</a> e <a href="https://en.wikipedia.org/wiki/Rust_%28programming_language%29">Rust</a> s√£o &ldquo;intermedi√°rias&rdquo;, isso n√£o quer dizer que existe uma escala fixa entre &ldquo;baixo n√≠vel&rdquo; (<a href="https://en.wikipedia.org/wiki/Assembly_language">Assembly</a>) e &ldquo;alto n√≠vel&rdquo; (<a href="https://en.wikipedia.org/wiki/Java_%28programming_language%29">Java</a>, <a href="https://en.wikipedia.org/wiki/Python_%28programming_language%29">Python</a>) e que elas ficam sempre no meio.</p></blockquote>
<p>Na verdade, √© s√≥ uma forma de dizer que elas misturam caracter√≠sticas dos dois lados: d√£o bastante controle sobre o computador (como <a href="https://en.wikipedia.org/wiki/Assembly_language">Assembly</a>), mas tamb√©m oferecem recursos que facilitam a vida do programador (como <a href="https://en.wikipedia.org/wiki/Java_%28programming_language%29">Java</a> ou <a href="https://en.wikipedia.org/wiki/Python_%28programming_language%29">Python</a>).</p>
<blockquote>
<p>Por exemplo, C deixa voc√™ mexer direto na mem√≥ria, mas ainda √© mais f√°cil de usar do que Assembly. Go e Rust v√£o al√©m: trazem recursos modernos, ajudam a evitar erros de mem√≥ria e, no caso do Rust, permitem escrever c√≥digo seguro e r√°pido sem perder desempenho.</p></blockquote>
<p>Ou seja, &ldquo;intermedi√°ria&rdquo; √© s√≥ um jeito de dizer que essas linguagens conseguem equilibrar controle e facilidade, ficando entre o mundo das linguagens super pr√≥ximas do hardware e o das linguagens super abstratas.</p>
<h2 id="o-compilador-do-rust">O compilador do Rust</h2>
<p>Quando a gente fala de compilador, normalmente ele √© dividido em tr√™s partes: <strong>frontend</strong> (a parte que entende o seu c√≥digo e transforma em uma estrutura de √°rvore chamada AST), <strong>middle-end</strong> (que faz otimiza√ß√µes que valem pra qualquer computador) e <strong>backend</strong> (que transforma tudo em c√≥digo de m√°quina pra rodar no seu PC). O Rust segue esse modelo, mas adiciona umas etapas extras s√≥ pra garantir que ningu√©m vai fazer besteira com a mem√≥ria.</p>
<p><img src="https://raw.githubusercontent.com/scovl/scovl.github.io/refs/heads/main/blog/content/post/images/rustcomp01.png" alt="Rust Compiler"></p>
<p>A imagem acima mostra que o compilador do Rust funciona como uma linha de montagem em tr√™s etapas: primeiro ele l√™ e entende seu c√≥digo (frontend), depois faz uma checagem rigorosa das regras de seguran√ßa de mem√≥ria (middle, onde entra o <a href="https://doc.rust-lang.org/reference/borrow-checker.html">borrow checker</a>), e por fim transforma tudo em c√≥digo de m√°quina que o computador entende (backend); assim, cada parte cuida de um tipo de problema e, no final, seu programa sai r√°pido e seguro, sem aquelas dores de cabe√ßa t√≠picas de bugs de mem√≥ria.</p>
<p>Quando voc√™ manda o Rust compilar seu arquivo <code>.rs</code>, a primeira coisa que acontece √© que o compilador l√™ o texto e separa tudo em &ldquo;palavrinhas&rdquo; chamadas <em>tokens</em> (nomes de vari√°veis, n√∫meros, s√≠mbolos, etc). Isso √© o trabalho do <strong><a href="https://en.wikipedia.org/wiki/Lexical_analysis">analisador l√©xico</a></strong>.</p>
<p><img src="https://raw.githubusercontent.com/scovl/scovl.github.io/refs/heads/main/blog/content/post/images/rustcomp02.png" alt="Lexing"></p>
<p>A imagem acima mostra, de forma bem simples, como o compilador do Rust come√ßa a entender seu c√≥digo: primeiro ele l√™ o texto do programa e separa tudo em &ldquo;palavrinhas&rdquo; chamadas tokens (tipo nomes de vari√°veis, n√∫meros, s√≠mbolos), e depois organiza esses tokens em uma esp√©cie de √°rvore que mostra como as partes do seu c√≥digo se encaixam ‚Äî como se fosse um esqueleto do programa (a <strong><a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a></strong>).</p>
<p>Ou seja, a figura mostra que o compilador transforma o texto que voc√™ escreveu em uma estrutura organizada, facilitando para as pr√≥ximas etapas encontrarem erros e entenderem o que o programa realmente faz.</p>
<p><img src="https://raw.githubusercontent.com/scovl/scovl.github.io/refs/heads/main/blog/content/post/images/rustcomp03.png" alt="AST"></p>
<p>Nessa etapa, o compilador tamb√©m j√° expande as <strong>macros</strong>. Ou seja, se voc√™ usou algum &ldquo;atalho&rdquo; ou macro, ele j√° troca pelo c√≥digo real, pra facilitar as pr√≥ximas fases. Agora vem uma etapa crucial: o compilador pega a AST (que ainda tem comandos de alto n√≠vel, tipo o <code>for</code>) e faz um &ldquo;rebaixamento&rdquo; <strong><a href="https://en.wikipedia.org/wiki/Code_lowering">lowering</a></strong>: transforma a AST numa vers√£o mais simples chamada <strong><a href="https://en.wikipedia.org/wiki/High-level_intermediate_representation">HIR</a></strong> (High-level IR).</p>
<p>Essa transforma√ß√£o √© fundamental porque a HIR √© mais pr√≥xima do que a linguagem realmente entende ‚Äî ela remove a complexidade da sintaxe e deixa tudo mais &ldquo;quadradinho&rdquo; para as pr√≥ximas an√°lises.</p>
<p>Em seguida, ele faz a an√°lise de tipos e gera a <strong><a href="https://en.wikipedia.org/wiki/Typed_high_level_intermediate_representation">THIR</a></strong> (Typed HIR), onde cada pedacinho do c√≥digo j√° tem um tipo definido (int, string, etc).</p>
<p>Antes de seguir, o compilador faz uma checagem de seguran√ßa chamada <strong>unsafety</strong>: ele olha a THIR pra garantir que coisas perigosas (tipo mexer direto na mem√≥ria com ponteiros) s√≥ aconte√ßam dentro de blocos marcados como <code>unsafe</code>. Assim, ele j√° barra muita coisa errada antes mesmo de virar c√≥digo de verdade.</p>
<p>A <strong><a href="https://en.wikipedia.org/wiki/Mid-level_intermediate_representation">MIR</a></strong> converte o programa num <strong><a href="https://en.wikipedia.org/wiki/Control-flow_graph">Grafo de Fluxo de Controle (CFG)</a></strong> expl√≠cito. Esse grafo permite ao <strong><a href="https://doc.rust-lang.org/reference/borrow-checker.html">borrow checker</a></strong> rastrear, ao longo de todos os caminhos de execu√ß√£o, o estado de cada valor: possu√≠do, emprestado mut√°vel, emprestado imut√°vel ou movido.</p>
<p><img src="https://raw.githubusercontent.com/scovl/scovl.github.io/refs/heads/main/blog/content/post/images/rustcomp04.png" alt="CFG"></p>
<p>A imagem acima ilustra um exemplo simplificado de um <strong>Grafo de Fluxo de Controle (CFG)</strong>. Nela, o c√≠rculo azul no topo representa um ponto de decis√£o ou condi√ß√£o no seu c√≥digo (como um <code>if</code> ou <code>match</code>). As setas que partem dele mostram os poss√≠veis caminhos que o programa pode seguir: um para o caso <code>True</code> (c√≠rculo vermelho √† esquerda) e outro para o caso <code>False</code> (c√≠rculo vermelho √† direita).</p>
<p>Ambos os caminhos convergem para o c√≠rculo verde pontilhado na parte inferior, que simboliza a continua√ß√£o do programa ap√≥s a decis√£o. √â essa representa√ß√£o em grafo que permite ao <strong><a href="https://doc.rust-lang.org/reference/borrow-checker.html">borrow checker</a></strong> do Rust analisar todos os fluxos poss√≠veis do seu c√≥digo e garantir a seguran√ßa da mem√≥ria em cada um deles, independentemente de qual caminho o programa realmente tomar em tempo de execu√ß√£o.</p>
<h2 id="o-mago-da-mem√≥ria-entendendo-o-borrow-checker">O Mago da Mem√≥ria: Entendendo o Borrow Checker</h2>
<p>O <strong><a href="https://doc.rust-lang.org/reference/borrow-checker.html">borrow checker</a></strong> √© o cora√ß√£o do sistema de seguran√ßa do Rust. Ele funciona como um inspetor rigoroso que analisa cada peda√ßo do seu c√≥digo para garantir que ningu√©m vai mexer na mem√≥ria de forma perigosa. Usando a MIR como base, o borrow checker rastreia tr√™s estados principais para cada valor:</p>
<ol>
<li><strong>Possu√≠do (Owned)</strong>: O valor pertence exclusivamente a uma vari√°vel</li>
<li><strong>Emprestado Imut√°vel (Borrowed Immutable)</strong>: Outras partes do c√≥digo podem ler, mas n√£o modificar</li>
<li><strong>Emprestado Mut√°vel (Borrowed Mutable)</strong>: Apenas uma parte pode ler e modificar por vez</li>
</ol>
<p>Caso uma viola√ß√£o ocorra (uso de valor ap√≥s movimento, cria√ß√£o de dados mut√°veis e imut√°veis simult√¢neos, etc.), o compilador rejeita o c√≥digo. Esse mecanismo previne <strong><a href="https://en.wikipedia.org/wiki/Race_condition">data races</a></strong> e <strong><a href="https://en.wikipedia.org/wiki/Use-after-free">use‚Äëafter‚Äëfree</a></strong> sem custo em tempo de execu√ß√£o. O borrow checker √© t√£o eficiente que muitos programadores Rust brincam que ele √© &ldquo;o melhor professor de programa√ß√£o que voc√™ j√° teve&rdquo; ‚Äî ele te ensina boas pr√°ticas de mem√≥ria antes mesmo do programa rodar!</p>
<p>Ap√≥s otimiza√ß√µes em MIR (elimina√ß√£o de c√≥digo morto, <strong><a href="https://en.wikipedia.org/wiki/Inline_function">inlining</a></strong> local, etc.), a IR √© traduzida para <strong><a href="https://llvm.org/docs/LangRef.html">LLVM IR</a></strong>. A <strong><a href="https://llvm.org/docs/LangRef.html">LLVM IR</a></strong> (Low Level Virtual Machine Intermediate Representation) √© uma linguagem intermedi√°ria de baixo n√≠vel, mas independente da arquitetura do processador.</p>
<p>√â nela que o Rust traduz tudo o que foi checado e otimizado at√© aqui, para que a LLVM possa realizar o trabalho pesado de otimiza√ß√£o de c√≥digo. A LLVM IR n√£o √© literalmente &ldquo;entendida pelo processador&rdquo; ‚Äî ela serve como uma representa√ß√£o intermedi√°ria que o LLVM usa para gerar o c√≥digo nativo espec√≠fico da arquitetura de destino (como x86-64, ARM, etc.).</p>
<p><img src="https://raw.githubusercontent.com/scovl/scovl.github.io/refs/heads/main/blog/content/post/images/rustcomp05.png" alt="LLVM IR"></p>
<p>O LLVM aplica otimiza√ß√µes espec√≠ficas de arquitetura e, por fim, gera c√≥digo objeto para a plataforma‚Äëalvo, como x86‚Äë64 ou AArch64. Como consequ√™ncia, um bin√°rio Rust √© normalmente espec√≠fico √† arquitetura de destino, a menos que se utilize camadas de emula√ß√£o.</p>
<h2 id="por-que-tanta-etapa-intermedi√°ria">Por que tanta etapa intermedi√°ria?</h2>
<p>Pense assim: cada IR (representa√ß√£o intermedi√°ria) √© como um filtro diferente que o compilador usa para checar seu c√≥digo. Primeiro, a HIR guarda bastante informa√ß√£o para que o compilador possa te dar mensagens de erro detalhadas e entender o contexto do seu programa. Depois, a MIR simplifica tudo, deixando o c√≥digo mais &ldquo;quadradinho&rdquo; e f√°cil de analisar ‚Äî √© nessa hora que o <strong><a href="https://doc.rust-lang.org/reference/borrow-checker.html">borrow checker</a></strong> entra em a√ß√£o, garantindo que ningu√©m vai mexer na mem√≥ria de um jeito perigoso.</p>
<p>Essa divis√£o em camadas faz com que cada parte do compilador s√≥ precise se preocupar com um tipo de problema por vez. Isso facilita encontrar erros antes mesmo do programa rodar, sem deixar o c√≥digo final mais lento.</p>
<p>E, pra fechar com chave de ouro, o Rust entrega a √∫ltima etapa (gerar o c√≥digo de m√°quina de verdade) pro LLVM, que j√° √© um especialista em otimiza√ß√£o e velocidade. Assim, o Rust foca em garantir seguran√ßa e o LLVM em deixar tudo r√°pido.</p>
<p>No fim das contas, o compilador do Rust funciona como uma linha de montagem cheia de inspe√ß√µes: cada etapa checa uma coisa diferente, pegando v√°rios erros que em outras linguagens s√≥ apareceriam quando o programa j√° estivesse rodando (ou pior, em produ√ß√£o!). Por isso, muita gente acredita que esse modelo de &ldquo;camadas inteligentes&rdquo; vai ser cada vez mais comum nas linguagens do futuro, juntando robustez e desempenho sem dor de cabe√ßa.</p>
<p>Por fim, vale destacar: linguagens como C e C++ n√£o adotam esse modelo de m√∫ltiplas camadas de checagem autom√°tica durante a compila√ß√£o. Nelas, o compilador faz an√°lises mais simples e deixa a maior parte dos cuidados com mem√≥ria e seguran√ßa por conta do programador.</p>
<p>Isso significa que muitos erros perigosos ‚Äî como acessar mem√≥ria j√° liberada, criar <strong><a href="https://en.wikipedia.org/wiki/Race_condition">data races</a></strong> ou sobrescrever dados sem querer ‚Äî s√≥ aparecem quando o programa j√° est√° rodando, e √†s vezes nem s√£o detectados. O Rust, ao contr√°rio, pega esses problemas antes mesmo do c√≥digo virar um execut√°vel, tornando o desenvolvimento mais seguro sem sacrificar desempenho.</p>
<blockquote>
<p><a href="https://www.abeacha.com/NIST_press_release_bugs_cost.html">Um estudo de 2002 e publicado em2019 da National Institute of Standards and Technology (NIST)</a> estimou que os erros de software custam √† economia dos EUA mais de 59,5 bilh√µes de d√≥lares anualmente, com uma parcela significativa desses custos vindo de vulnerabilidades de seguran√ßa e falhas de mem√≥ria. A aus√™ncia de checagens autom√°ticas em C/C++ contribui para que esses tipos de falhas se tornem uma preocupa√ß√£o constante.</p></blockquote>
<p>Para n√£o soar como injusto, √© necess√°rio dizer que o C++23 trouxe v√°rias novidades para tentar deixar o c√≥digo mais seguro e moderno, especialmente quando o assunto √© evitar bugs de mem√≥ria ‚Äî mas sem mudar a linguagem de cabe√ßa pra baixo.</p>
<p>Agora, por exemplo, d√° pra declarar de forma expl√≠cita quando um objeto come√ßa a existir na mem√≥ria (com o <strong><a href="https://en.cppreference.com/w/cpp/language/lifetime#start_lifetime_as">start_lifetime_as</a></strong>), o que ajuda a evitar aqueles bugs cabeludos que nem os detectores autom√°ticos pegavam. Tamb√©m ficou mais f√°cil e seguro conversar com APIs em C sem correr o risco de vazar mem√≥ria, gra√ßas a novos adaptadores de ponteiros inteligentes.</p>
<p>Os containers ganharam vers√µes que evitam acesso fora dos limites (tipo o <strong><a href="https://en.cppreference.com/w/cpp/container/mdspan">mdspan</a></strong> para matrizes), e ficou mais pr√°tico lidar com erros usando o <strong><a href="https://en.cppreference.com/w/cpp/utility/expected">std::expected</a></strong>, que incentiva o retorno expl√≠cito de falhas em vez de depender de c√≥digos m√°gicos ou vari√°veis globais.</p>
<p>At√© a formata√ß√£o de texto ficou mais f√°cil, <a href="https://en.cppreference.com/w/cpp/io/c/fprintf">com fun√ß√µes no estilo Python</a>, e agora d√° pra gerar <a href="https://en.cppreference.com/w/cpp/error/stacktrace">stacktraces port√°veis sem gambiarra</a>. Apesar desses avan√ßos, algumas prote√ß√µes autom√°ticas que o Rust j√° oferece ‚Äî como checagem de uso de ponteiros e detec√ß√£o de data races ‚Äî ainda n√£o chegaram no C++ (ficaram pra pr√≥xima vers√£o).</p>
<blockquote>
<p>Ou seja: o C++23 est√° caminhando para fechar v√°rias brechas hist√≥ricas e facilitar a vida do programador, mas ainda depende bastante de disciplina e ferramentas externas, enquanto o Rust j√° faz muita coisa ‚Äúno autom√°tico‚Äù para garantir a seguran√ßa do seu c√≥digo.</p></blockquote>
<p>Enquanto o compilador do Rust atua como um inspetor de qualidade rigoroso, rejeitando qualquer c√≥digo que possa violar as regras de seguran√ßa de mem√≥ria, o compilador de C/C++ foca em traduzir o c√≥digo de forma fiel e otimizada. Ele assume que o programador √© o respons√°vel por todas as garantias de seguran√ßa.</p>
<hr>
<h2 id="refer√™ncias">REFER√äNCIAS</h2>
<ul>
<li><a href="https://doc.rust-lang.org/reference/">The Rust Reference - The Rust Compiler</a> - A refer√™ncia oficial do Rust sobre o compilador e a linguagem.</li>
<li><a href="https://doc.rust-lang.org/rustc/">The Rustc Book</a> - O livro oficial do Rust sobre o compilador.</li>
<li><a href="https://rustc-dev-guide.rust-lang.org/overview.html">Rust Compiler Architecture Overview</a> - Uma vis√£o geral da arquitetura do compilador do Rust.</li>
<li><a href="https://llvm.org/docs/LangRef.html">LLVM Language Reference Manual</a> - A refer√™ncia oficial do LLVM sobre a linguagem intermedi√°ria.</li>
<li><a href="https://en.cppreference.com/w/cpp/23">C++23</a> - A refer√™ncia oficial do C++23.</li>
<li><a href="https://github.com/baindlapranayraj/SolanaBlogs/blob/main/">Solana Blogs</a> - Onde o artigo se baseou.</li>
<li><a href="https://medium.com/@humble_bee/why-is-memory-safety-without-gc-a-big-deal-in-rust-41f6bdd5902f">Why is memory safety without GC a big deal in Rust?</a> - Um artigo sobre a import√¢ncia da seguran√ßa de mem√≥ria sem GC no Rust.</li>
<li><a href="https://rustc-dev-guide.rust-lang.org/overview.html#:~:text=Code%20generation">Overview of the compiler</a> - Uma se√ß√£o do guia do Rust sobre a gera√ß√£o de c√≥digo.</li>
<li><a href="https://aneksteind.github.io/posts/2023-06-12.html#:~:text=Exploring%20Dataflow%20Analysis%20in%20the,control%20flow%20graph%20structure">Exploring Dataflow Analysis in the Rust Compiler</a> - Um artigo sobre a an√°lise de fluxo de dados no compilador do Rust.</li>
<li><a href="https://www.infoq.com/presentations/rust-borrow-checker/#:~:text=lowers%20it%20into%20the%20mid,also%20known%20as%20the%20MIR">Rust Borrow Checker</a> - Uma apresenta√ß√£o sobre o borrow checker do Rust.</li>
</ul>

    </div>
    
    
    



    
    
    
        
    
        
            
            
            
            
                
                    
                
                    
                
                    
                        
                        
                    
                
                    
                
                    
                
            
            
            
                
            
        
    
        
            
            
            
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
            
        
    
        
            
            
            
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
            
        
    
        
            
            
            
            
                
                    
                
                    
                
                    
                
                    
                
            
            
            
        
    
        
            
            
            
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
            
        
    
        
            
            
            
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
            
        
    
        
            
            
            
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
            
            
        
    
        
            
            
            
            
            
            
        
    
        
            
            
            
            
            
            
        
    
    
    
        
        
        
        <div class="related-posts">
            <h3 class="related-posts-title">üìö Posts Relacionados</h3>
            <div class="related-posts-grid">
                
                    
                    <article class="related-post-item animate-on-scroll">
                        <div class="related-post-content">
                            <h4 class="related-post-title">
                                <a href="/2025/07/18/type01/">Infer√™ncia de Tipos em Rust e C&#43;&#43;</a>
                            </h4>
                            <p class="related-post-excerpt">
                                <h2 id="introdu√ß√£o">Introdu√ß√£o</h2>
<p>Infer√™ncia de tipos √© o mecanismo pelo qual o compilador descobre automaticamente o tipo de uma vari√°vel ou express√£o em uma linguagem de programa√ß√£o. Esse recurso permite que o programador omita anota√ß√µes de tipo em muitas situa√ß√µes sem comprometer a seguran√ßa de tipos do programa.</p>
<p>Neste artigo, discutimos como as linguagens <strong><a href="https://www.rust-lang.org/">Rust</a></strong> e <strong><a href="https://en.wikipedia.org/wiki/C%2B%2B">C++</a></strong> implementam infer√™ncia de tipos de formas fundamentalmente diferentes, analisando as consequ√™ncias pr√°ticas de cada abordagem.</p>
                            </p>
                            <div class="related-post-meta">
                                <span class="related-post-date">18/07/2025</span>
                                
                                    <div class="related-post-tags">
                                        
                                            <span class="tag">Infer√™ncia de Tipos</span>
                                        
                                            <span class="tag">Programa√ß√£o</span>
                                        
                                    </div>
                                
                            </div>
                            <div class="related-post-score">
                                <modern-badge variant="info">1 tags em comum</modern-badge>
                            </div>
                        </div>
                    </article>
                
            </div>
        </div>
    

    
    
    
    
<div class="comments-section">
    <h3 class="comments-title">üí¨ Coment√°rios</h3>
    <div class="comments-container">
        <script src="https://giscus.app/client.js"
                data-repo="scovl/scovl.github.io"
                data-repo-id="MDEwOlJlcG9zaXRvcnkxMzg1OTI2ODA="
                data-category="General"
                data-category-id="DIC_kwDOCELBqM4CthUV"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="1"
                data-emit-metadata="0"
                data-input-position="bottom"
                data-theme="light"
                data-lang="pt"
                crossorigin="anonymous"
                async>
        </script>
    </div>
</div>

    
</article>

        </div>
    </main>
    
    
    
    <footer class="footer">
    <div class="container">
        <div class="footer-content">
            <div class="footer-links">
                
                <a href="https://github.com/scovl" target="_blank" rel="noopener noreferrer" class="footer-link">
                    GitHub
                </a>
                
                
                
                <a href="https://linkedin.com/in/vitor-lobo" target="_blank" rel="noopener noreferrer" class="footer-link">
                    LinkedIn
                </a>
                
                
                
                <a href="mailto:lobocode@gmail.com" class="footer-link">
                    Email
                </a>
                

                
                <a href="https://hachyderm.io/@lobocode" target="_blank" rel="noopener noreferrer" class="footer-link">
                    Mastodon
                </a>
                

                
                <a href="https://scovl.github.io/index.xml" target="_blank" rel="noopener noreferrer" class="footer-link">
                    RSS
                </a>
                
            </div>
            
            
            <div class="back-to-top-container">
                <button id="back-to-top" class="back-to-top-btn" aria-label="Voltar ao topo">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m18 15-6-6-6 6"/>
                    </svg>
                    <span data-i18n="back_to_top">Voltar ao topo</span>
                </button>
            </div>
            
            <div class="copyright">
                &copy; 2025 scovl
            </div>
        </div>
    </div>
</footer> 
    
    
    
    <script src="/vendor/prism/prism-core.min.js?v=1757087164"></script>
    <script src="/vendor/prism/prism-clike.min.js?v=1757087164"></script>
    <script src="/vendor/prism/prism-c.min.js?v=1757087164"></script>
    <script src="/vendor/prism/prism-cpp.min.js?v=1757087164"></script>
    <script src="/vendor/prism/prism-rust.min.js?v=1757087164"></script>
    <script src="/vendor/prism/prism-clojure.min.js?v=1757087164"></script>
    <script src="/vendor/prism/prism-swift.min.js?v=1757087164"></script>
    <script src="/vendor/prism/prism-bash.min.js?v=1757087164"></script>
    <script src="/vendor/prism/prism-autoloader.min.js?v=1757087164"></script>
    
    
    <script src="/js/main-minimal.js?v=1757087164"></script>
    <script src="/js/lazy-loading.js?v=1757087164"></script>
    <script src="/js/toc.js?v=1757087164"></script>
    
    
    
</body>
</html> 